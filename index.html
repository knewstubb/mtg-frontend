<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTG Commander Simulator - Game Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }
        .ui-panel {
            transition: opacity 0.5s ease-in-out;
        }
        .hand-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .hand-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }
    </style>
</head>
<body class="text-white antialiased">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-100">MTG Commander Simulator</h1>
            <p id="phase-display" class="text-xl text-gray-400 mt-2">Phase 1: Foundation</p>
        </header>

        <main>
            <!-- Deck Importer (Visible by default) -->
            <div id="importer-panel" class="bg-gray-800 rounded-lg shadow-xl p-6 ui-panel max-w-2xl mx-auto">
                <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Create New Game</h2>
                <p class="text-gray-300 mb-4">Paste a public Moxfield or Archidekt deck URL to begin.</p>
                 <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="deck-url-input" placeholder="Moxfield or Archidekt URL" class="w-full bg-gray-700 border border-gray-600 text-white rounded-md px-4 py-2 focus:ring-2 focus:ring-green-500 focus:outline-none placeholder-gray-500">
                    <button id="import-deck-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-md shadow-lg transition-transform transform hover:scale-105">
                        Create Game
                    </button>
                </div>
            </div>

            <!-- Game Display Panel (Hidden by default) -->
            <div id="game-panel" class="hidden mt-8 ui-panel">
                <div id="loader" class="hidden text-center py-8">
                    <svg class="animate-spin h-10 w-10 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-4 text-gray-400 text-lg" id="loader-text">Loading...</p>
                </div>
                
                <div id="error-message" class="hidden bg-red-800 border border-red-600 text-red-100 px-4 py-3 rounded-lg relative mb-6" role="alert">
                    <strong class="font-bold">Error!</strong>
                    <span class="block sm:inline" id="error-text">An error occurred.</span>
                </div>

                <!-- Game State Display -->
                <div id="game-state-container" class="hidden space-y-8">
                    <div id="player-info-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Player info cards will be injected here -->
                    </div>
                    
                    <!-- Action Bar -->
                    <div class="text-center">
                         <button id="next-phase-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105 text-lg">
                            Next Phase
                        </button>
                    </div>

                    <!-- Player's Hand Display -->
                     <div>
                        <h3 class="text-2xl font-semibold mb-4 text-gray-300 border-b border-gray-700 pb-2">Your Hand</h3>
                        <div id="player-hand-container" class="flex flex-wrap justify-center gap-4 min-h-[210px]">
                           <!-- Player's hand cards will be injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- UI Elements ---
            const importDeckButton = document.getElementById('import-deck-button');
            const deckUrlInput = document.getElementById('deck-url-input');
            const nextPhaseButton = document.getElementById('next-phase-button');
            
            const importerPanel = document.getElementById('importer-panel');
            const gamePanel = document.getElementById('game-panel');
            const loader = document.getElementById('loader');
            const loaderText = document.getElementById('loader-text');
            const errorMessage = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            const gameStateContainer = document.getElementById('game-state-container');
            const playerInfoContainer = document.getElementById('player-info-container');
            const playerHandContainer = document.getElementById('player-hand-container');
            const phaseDisplay = document.getElementById('phase-display');

            // --- Configuration ---
            // IMPORTANT: PASTE YOUR RENDER URL HERE, replacing the example URL.
            const RENDER_SERVER_URL = 'https://brad-mtg-server.onrender.com'; // <-- PASTE YOUR RENDER URL HERE

            const CREATE_GAME_URL = `${RENDER_SERVER_URL}/create-game`;
            const NEXT_PHASE_URL = `${RENDER_SERVER_URL}/next-phase`;

            // --- UI Control Functions ---
            const showLoader = (text) => {
                gamePanel.classList.remove('hidden');
                loaderText.textContent = text;
                loader.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                gameStateContainer.classList.add('hidden');
            };

            const hideLoader = () => loader.classList.add('hidden');

            const showError = (message) => {
                gamePanel.classList.remove('hidden');
                errorText.textContent = message;
                errorMessage.classList.remove('hidden');
                hideLoader();
            };

            // --- Game Logic Functions ---
            const handleCreateGame = async () => {
                const url = deckUrlInput.value.trim();
                if (!url) {
                    showError('Please enter a deck URL.');
                    return;
                }
                 if (RENDER_SERVER_URL.includes('your-server-name')) {
                    alert("Please update the RENDER_SERVER_URL in the index.html file with your real Render URL.");
                    return;
                }
                showLoader('Creating game on server...');

                try {
                    const response = await fetch(CREATE_GAME_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ deckUrl: url })
                    });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Server error (${response.status})`);
                    }
                    const initialGameState = await response.json();
                    updateUI(initialGameState);
                } catch (error) {
                    showError(`Failed to create game: ${error.message}`);
                }
            };
            
            const handleNextPhase = async () => {
                nextPhaseButton.disabled = true;
                nextPhaseButton.textContent = 'Advancing...';
                nextPhaseButton.classList.add('opacity-50', 'cursor-not-allowed');

                try {
                    const response = await fetch(NEXT_PHASE_URL, { method: 'POST' });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Server error (${response.status})`);
                    }
                    const newGameState = await response.json();
                    updateUI(newGameState);
                } catch (error) {
                     showError(`Failed to advance phase: ${error.message}`);
                } finally {
                    nextPhaseButton.disabled = false;
                    nextPhaseButton.textContent = 'Next Phase';
                    nextPhaseButton.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            };

            function updateUI(gameState) {
                hideLoader();
                importerPanel.classList.add('hidden');
                
                phaseDisplay.textContent = `Turn ${gameState.turn} - ${gameState.activePlayerName}'s ${gameState.phase} (${gameState.step})`;

                playerInfoContainer.innerHTML = '';
                gameState.players.forEach(player => {
                    const playerCard = document.createElement('div');
                    const isActive = player.name === gameState.activePlayerName;
                    playerCard.className = `bg-gray-700 rounded-lg p-4 shadow-lg border-2 ${isActive ? 'border-yellow-400' : 'border-transparent'}`;
                    playerCard.innerHTML = `
                        <h3 class="text-xl font-semibold text-white">${player.name} ${isActive ? '<span class="text-yellow-400 text-sm">(Active)</span>' : ''}</h3>
                        <p class="text-sm text-gray-400 truncate" title="${player.deckName}">Deck: ${player.deckName}</p>
                        <p class="text-sm text-gray-400 mb-2">Commander: ${player.commanderName}</p>
                        <div class="mt-4 grid grid-cols-2 gap-2 text-gray-300">
                            <p><strong>Life:</strong> <span class="font-mono text-lg text-green-400">${player.life}</span></p>
                            <p><strong>Hand:</strong> <span class="font-mono text-lg text-blue-400">${player.handCount}</span></p>
                            <p><strong>Library:</strong> <span class="font-mono text-lg text-yellow-400">${player.libraryCount}</span></p>
                            <p><strong>Graveyard:</strong> <span class="font-mono text-lg text-red-400">${player.graveyardCount}</span></p>
                        </div>
                    `;
                    playerInfoContainer.appendChild(playerCard);
                });

                const player1 = gameState.players.find(p => p.name === 'Player 1');
                playerHandContainer.innerHTML = '';
                if (player1 && player1.hand.length > 0) {
                    player1.hand.forEach(card => {
                        const cardImg = document.createElement('img');
                        cardImg.src = card.imageUris.normal;
                        cardImg.alt = card.name;
                        cardImg.className = 'w-32 rounded-lg hand-card cursor-pointer';
                        cardImg.title = card.name;
                        playerHandContainer.appendChild(cardImg);
                    });
                } else {
                    playerHandContainer.innerHTML = `<p class="text-gray-500">No cards in hand.</p>`;
                }
                
                gameStateContainer.classList.remove('hidden');
            };

            // --- Event Listeners ---
            importDeckButton.addEventListener('click', handleCreateGame);
            deckUrlInput.addEventListener('keydown', (e) => e.key === 'Enter' && handleCreateGame());
            nextPhaseButton.addEventListener('click', handleNextPhase);
        });
    </script>
</body>
</html>
